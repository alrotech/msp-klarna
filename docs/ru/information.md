### Платежная система Klarna

**[Klarna][klarna.com]** — это ведущая глобальная служба платежей и покупок, обеспечивающая более разумные и гибкие возможности совершения покупок для 90 миллионов активных потребителей в более чем 250 000 торговых точек в 17 странах. Klarna предлагает прямые платежи, варианты оплаты после доставки и рассрочку в удобном режиме покупки в один клик, который позволяет потребителям платить, когда и как они предпочитают.

#### Возможности модуля интеграции

Модуль **mspKlarna** позволяет передавать информацию о заказе из **miniShop2** в платежную систему **Klarna**, а так же обрабатывать запросы со стороны платежной системы, и менять статусы заказа в соответствии с настройками.

Пока что поддерживается только вариант с отдельной платежной страницей (Hosted Page в терминах платежной системы), так как это наиболее точно соответствует модели работы miniShop. Есть возможность отправлять ссылку на оплату в письме, так как реализован метод `getPaymentLink`.

В настройках модуля можно дополнительно настроить регион, страну плательщика, валюту платежа и другие параметры, необходимые для заключения сделки между интернет-магазином и покупателем.

#### Новости и обновления

Значимые обновления будут публиковаться на сайте сообщества [modx.pro] в виде анонсов, подробные же изменения всегда можно найти в [списке изменений][changelog].

— [mspKlarna — новый платежный модуль для miniShop2](#).

#### Установка, настройка и использование

Установка модуля осуществляется через административную часть вашего сайта на MODX. Для установки модуля необходимо перейти в раздел <em>Пакеты</em> и далее в <em>Установщик</em> главного меню, [подключить репозиторий modstore.pro][connection], выбрать из списка пакетов `mspKlarna` и следовать дальнейшим инструкциям установщика.

Модуль для работы требует: PHP 7.4+, MODX 2.8+, установленный вспомогательный компонент [msPaymentProps], а так же некоторые PHP Extensions. Описание процесса установки и настройки компонента, справка по всем доступным параметрам конфигурации, и исчерпывающий список зависимостей доступны в [подробной документации][documentation].

Быстро проверить работу модуля можно используя компонент [Console] (или [modalConsole]). Откройте окно компонента `Console` и выполните приведенный ниже код.

```php
require_once MODX_CORE_PATH . 'components/mspklarna/KlarnaHandler.class.php';

if ($order = $modx->getObject(msOrder::class, 1)) { // 1 – id заказа
    echo (new KlarnaHandler($order))->getPaymentLink($order);
}
```

В ответ вы должны получить ссылку, по которой откроется окно оплаты, либо сообщение об ошибке, если настройка модуля была выполнена неправильно.

#### Техническая поддержка

Для получения технической поддержки по этому модулю задайте вопрос через [специальную форму][support] (доступна после авторизации). Техническая поддержка осуществляется согласно [правилам][rules] **modstore**, т.е. при покупке вы получаете 1 год технической поддержки и обновлений модуля. По истечении года есть возможность продлить, оплатив еще раз лицензию.

#### Авторство и лицензия

Код модуля распространяется по лицензии MIT, тем не менее распространение и продажа готового модуля, в виде собранного пакета для системы управления MODX, запрещается. При использовании частей кода, сохранение лицензии и указание авторства обязательны.

Автор исходного кода модуля и владелец прав на распространение: Иван Климчук.
[GitHub](https://github.com/alroniks) | [Twitter](https://twitter.com/iklimchuk) | [ivan@klimchuk.com](mailto:ivan@klimchuk.com) | [klimchuk.by](https://klimchuk.by/) | [alroniks.com](https://alroniks.com)

[klarna.com]: https://www.klarna.com/
[modx.pro]: https://modx.pro

[mspaymentprops]: https://modstore.pro/packages/utilities/mspaymentprops
[modalconsole]: https://modstore.pro/packages/utilities/modalconsole
[console]: https://modx.com/extras/package/console

[documentation]: https://mspay.github.io/msp-klarna/ru/documentation
[changelog]: https://modstore.pro/packages/payment-system/mspklarna#tab/changelog

[connection]: https://modstore.pro/info/connection
[support]: https://modstore.pro/office/support
[rules]: https://modstore.pro/info/rules
